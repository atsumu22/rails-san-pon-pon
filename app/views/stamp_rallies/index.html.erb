<div class="view-container">

  <div class="scroll-content container">
    <div class="padding">
      <h1 class="mb-5">Our popular Stamp Rallies</h1>

      <% @stamp_rallies.each do |rally| %>
        <% unless rally.end_date.past? %>
          <%= link_to stamp_rally_path(rally) do %>
            <div class="rally-card <%= if rally.end_date.past?
                "finished"
              elsif Date.today.between?(rally.start_date, rally.end_date)
                "ongoing"
              else
                "soon"
              end %>">
              <div>
                <h6 class="rally-title"><%= rally.name %></h6>
                <p class="date"><%= rally.start_date %> - <%= rally.end_date %></p>
              </div>
              <div class="date-status">
                <p><%= pluralize(rally.shop_participants.count, "shop") %></p>
                <% if Date.today > rally.end_date %>
                  <p class="tag">Finished</p>
                <% elsif Date.today > rally.start_date && Date.today < rally.end_date %>
                  <p class="tag">Ongoing</p>
                <% else %>
                  <p class="tag">Coming soon</p>
                <% end %>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>

  </div>

  <div class="rally-map"
  data-controller="rally-map"
  data-rally-map-markers-value="<%= @markers.to_json %>"
  data-rally-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"></div>
</div>
